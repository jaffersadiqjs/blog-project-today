{% extends 'blog/base.html' %}
{% block title %}{{ post.title }}{% endblock %}
{% block content %}
<article>
  <h2>{{ post.title }}</h2>
  <p class="text-muted">By {{ post.author.username }} â€¢ {{ post.created_at|date:"M d, Y H:i" }}</p>
  {% if post.image %}
    <img src="{{ post.image.url }}" class="img-fluid mb-3" alt="{{ post.title }}">
  {% endif %}
  <div>{{ post.content|linebreaks }}</div>

  {% if user == post.author %}
    <p class="mt-3">
      <a class="btn btn-outline-secondary btn-sm" href="{% url 'blog:post-edit' post.slug %}">Edit</a>
      <a class="btn btn-outline-danger btn-sm" href="{% url 'blog:post-delete' post.slug %}">Delete</a>
    </p>
  {% endif %}
</article>

<hr>
<h5>Comments ({{ comments.count }})</h5>
<ul class="list-unstyled">
  {% for c in comments %}
    <li class="mb-2 border-bottom pb-2">
      <p><strong>{{ c.user.username }}</strong> <small class="text-muted">{{ c.created_at|date:"M d, Y H:i" }}</small></p>
      <p>{{ c.text|linebreaks }}</p>
      {% if user == c.user %}
        <form method="post" action="{% url 'blog:delete-comment' c.pk %}" style="display:inline;">
          {% csrf_token %}
          <button class="btn btn-sm btn-outline-danger">Delete</button>
        </form>
      {% endif %}
    </li>
  {% empty %}
    <li class="text-muted">No comments yet. Be the first!</li>
  {% endfor %}
</ul>

{% if user.is_authenticated %}
  <h6>Add a comment</h6>
  <form method="post" action="{% url 'blog:add-comment' post.slug %}">
    {% csrf_token %}
    {{ comment_form.as_p }}
    <button class="btn btn-primary btn-sm">Post Comment</button>
  </form>
{% else %}
  <p class="text-muted">Please <a href="{% url 'blog:login' %}">login</a> to comment.</p>
{% endif %}
{% endblock %}
